AM   - AM ou PM 
CC   - Século
D    - Dia da semana (1-7)
DAY  - Dia da semana ('SUNDAY')
DD   - Dia do mês (1-31)
DDD  - Dia do ano
DY   - Dia da semana abreviado ('SUN')
FM   - Tira os blanks ou Zeros da esquerda
HH   - Hora do dia (0-12)
HH24 - Hora do dia (0-24)
MI   - Minutos da Hora
MM   - Mês com 2 dígitos
MON  - Mês abreviado ('NOV')
MONTH- Mês por extenso ('NOVEMBER')
PM   - AM ou PM
RR   - Ano com 2 dígitos - especial
RRRR - Ano com 4 dígitos
SS   - Segundos do minuto(0 - 59)
SSSSS- Segundos do dia
W    - Semana do Mês
WW   - Semana do Ano
YEAR - Ano por extenso
YY   - Ano com 2 dígitos
YYYY - Ano com 4 dígitos

TO_CHAR(CP.DATA_ENTREGA,'ww') AS SEMANA_ANO,
TO_CHAR(CP.DATA_ENTREGA,'mm') AS MES_ANO

SELECT
MP.COD_PRODUTO,
CP.TECIDO_TECELAGEM,
(SELECT PR.DESCRICAO FROM PRODUTOS PR WHERE PR.COD_PRODUTO = (CASE 
  WHEN MP.COD_PRODUTO IS NULL THEN CP.TECIDO_TECELAGEM
  ELSE MP.COD_PRODUTO 
END)) AS DESCRICAO, 

(BUSCA_COD_TEARES_PRODUTO(MP.COD_PRODUTO)) AS COD_MAQ,
(BUSCA_TEARES_PRODUTO(MP.COD_PRODUTO)) AS TEARES
FROM MAQUINAS_PRODUTO MP
RIGHT JOIN CARTEIRA_PEDIDOS CP ON ((CP.TECIDO_TECELAGEM=MP.COD_PRODUTO))
WHERE CP.TECIDO_TECELAGEM IS NOT NULL
GROUP BY MP.COD_PRODUTO,CP.TECIDO_TECELAGEM
ORDER BY MP.COD_PRODUTO
                          

SELECT
(CASE 
  WHEN CP.TECIDO_TECELAGEM=0 THEN CP.COD_TECIDO
  ELSE CP.TECIDO_TECELAGEM 
END) AS PRODUTO_TECIDO,
(SELECT PR.DESCRICAO FROM PRODUTOS PR WHERE PR.COD_PRODUTO = (CASE 
  WHEN CP.TECIDO_TECELAGEM=0 THEN CP.COD_TECIDO
  ELSE CP.TECIDO_TECELAGEM 
END)) AS DESCRICAO,  
CP.METROS,
(SELECT COUNT(MP.COD_MAQUINA)FROM MAQUINAS_PRODUTO MP WHERE MP.COD_PRODUTO= (CASE 
  WHEN CP.TECIDO_TECELAGEM=0 THEN CP.COD_TECIDO
  ELSE CP.TECIDO_TECELAGEM 
END)) AS N_TEARES,
(BUSCA_COD_TEARES_PRODUTO((CASE 
  WHEN CP.TECIDO_TECELAGEM=0 THEN CP.COD_TECIDO
  ELSE CP.TECIDO_TECELAGEM 
END))) AS COD_MAQ,
(BUSCA_TEARES_PRODUTO((CASE 
  WHEN CP.TECIDO_TECELAGEM=0 THEN CP.COD_TECIDO
  ELSE CP.TECIDO_TECELAGEM 
END))) AS TEARES, 
CP.DATA_ENTREGA, 
TO_CHAR(CP.DATA_ENTREGA,'ww') AS SEMANA_ANO,
TO_CHAR(CP.DATA_ENTREGA,'mm') AS MES_ANO
--(SELECT COUNT( ) FROM 
FROM CARTEIRA_PEDIDOS CP
WHERE TRUNC(CP.DATA_ENTREGA) BETWEEN :DAT1 AND :DAT2
ORDER BY CP.DATA_ENTREGA,CP.TECIDO_TECELAGEM, (CASE 
  WHEN CP.TECIDO_TECELAGEM=0 THEN CP.COD_TECIDO
  ELSE CP.TECIDO_TECELAGEM 
END);



SELECT
MP.COD_PRODUTO,
CP.TECIDO_TECELAGEM,
(SELECT PR.DESCRICAO FROM PRODUTOS PR WHERE PR.COD_PRODUTO = (CASE 
  WHEN MP.COD_PRODUTO IS NULL THEN CP.TECIDO_TECELAGEM
  ELSE MP.COD_PRODUTO 
END)) AS DESCRICAO, 
(SUM_METROS_CARTEIRA_SEMANA(CP.TECIDO_TECELAGEM,TO_CHAR(:DAT,'ww'),TO_CHAR(:DAT,'mm'))) AS METROS_SEM,
(SUM_METROS_CARTEIRA_MES_REF(CP.TECIDO_TECELAGEM,TO_CHAR(:DAT,'ww'),TO_CHAR(:DAT,'mm'))) AS METROS_MES,
(SUM_METROS_CARTEIRA_MES_SEG(CP.TECIDO_TECELAGEM,TO_CHAR(:DAT,'mm'))) AS METROS_MES_SEG,
(SUM_METROS_ESTOQUE(CP.TECIDO_TECELAGEM)) AS ESTOQUE_TECIDO_TEC,
(BUSCA_COD_TEARES_PRODUTO(MP.COD_PRODUTO)) AS COD_MAQ,
(DIAS_UTEIS('A')) AS DIAS_UTEIS,
--(EFICIENCIA_MEDIA(MP.COD_PRODUTO,TO_CHAR(:DAT,'mm'))) AS EFICIENCIA,
(BUSCA_TEARES_PRODUTO(MP.COD_PRODUTO)) AS TEARES
FROM MAQUINAS_PRODUTO MP
RIGHT JOIN CARTEIRA_PEDIDOS CP ON ((CP.TECIDO_TECELAGEM=MP.COD_PRODUTO)) AND TO_CHAR(CP.DATA_ENTREGA,'mm')=TO_CHAR(:DAT,'mm')
WHERE CP.TECIDO_TECELAGEM IS NOT NULL
GROUP BY MP.COD_PRODUTO,CP.TECIDO_TECELAGEM
ORDER BY MP.COD_PRODUTO						  