CREATE OR REPLACE FUNCTION RETORNA_SALDO_ESTOQUE_ITEM (EMPRESA IN NUMBER, PRODUTO IN NUMBER)
 RETURN NUMBER IS SALDO NUMBER (11,2);   
BEGIN
  DECLARE 
   ENTRADAS NUMBER(11,2);
   SAIDAS   NUMBER(11,2);
BEGIN
  
   SELECT NVL(SUM(PR.QUANTIDADE),0) INTO ENTRADAS  FROM PRODUTOS_MOVIMENTO PR  WHERE (PR.COD_EMPRESA = EMPRESA)  AND (PR.COD_PRODUTO = PRODUTO)  AND (PR.TIPO_MOVIMENTO = 'E') AND (PR.SITUACAO = 'A');
   SELECT NVL(SUM(PR.QUANTIDADE),0) INTO SAIDAS  FROM PRODUTOS_MOVIMENTO PR  WHERE  (PR.COD_EMPRESA = EMPRESA)  AND (PR.COD_PRODUTO = PRODUTO)  AND (PR.TIPO_MOVIMENTO = 'S') AND (PR.SITUACAO = 'A');
   SALDO := (ENTRADAS - SAIDAS);

   RETURN SALDO;
END; 
END RETORNA_SALDO_ESTOQUE_ITEM;
