CREATE OR REPLACE TRIGGER DESENVOLVIMENTO.LOG_SOLICITACAO_MATERIAIS
AFTER DELETE OR INSERT OR UPDATE
ON DESENVOLVIMENTO.SOLICITACOES_MATERIAL
REFERENCING NEW AS New OLD AS Old
FOR EACH ROW
DECLARE
  Operacao  CHAR(1);
  Programa VARCHAR2(50);
  Usuario VARCHAR2(200);
  Hosts   VARCHAR2(200);

BEGIN 


SELECT SYS_CONTEXT('USERENV','OS_USER') AS USUARIO, SYS_CONTEXT ('USERENV', 'HOST') AS HOST  
INTO Usuario, Hosts 
from DUAL;

 

/*
    SELECT PROGRAM, ' ( '||OSUSER||' ) '||MACHINE  MAQUINA
    INTO Programa, Usuario
    FROM V$SESSION
    WHERE AUDSID = USERENV('SESSIONID'); */

  IF INSERTING THEN
    Operacao := 'I';
  ELSIF UPDATING THEN
    Operacao := 'U';
  ELSE    /* Há Deleção */
    Operacao := 'D';
  END IF;

  
IF Operacao = 'D' THEN /*DELETE*/  
  
INSERT INTO LOG_BANCO_DADOS( OPERACAO, CODIGO, DATA,  COD_USUARIO, TABELA, PROGRAMA,  USUARIO, HOST)
    VALUES (Operacao, :OLD.COD_SOLICITACAO, SYSDATE, :OLD.COD_USUARIO, 'SOLICITACAO_MATERIAL',  'SCR', Usuario, Hosts );            
   
END IF;


IF Operacao = 'I' THEN /*INSERT*/

INSERT INTO LOG_BANCO_DADOS( OPERACAO, CODIGO, DATA,  COD_USUARIO, TABELA, PROGRAMA,  USUARIO, HOST)
    VALUES (Operacao, :OLD.COD_SOLICITACAO, SYSDATE, :OLD.COD_USUARIO, 'SOLICITACAO_MATERIAL',  'SCR', Usuario, Hosts );   


END IF;


IF Operacao = 'U' THEN /*UPDATE*/

INSERT INTO LOG_BANCO_DADOS( OPERACAO, CODIGO, DATA,  COD_USUARIO, TABELA, PROGRAMA,  USUARIO, HOST)
    VALUES (Operacao, :OLD.COD_SOLICITACAO, SYSDATE, :OLD.COD_USUARIO, 'SOLICITACAO_MATERIAL',  'SCR', Usuario, Hosts );   
END IF;

   
   
   

   EXCEPTION
     WHEN OTHERS THEN
       -- Consider logging the error and then re-raise
       RAISE;
END LOG_SOLICITACAO_MATERIAIS;
/