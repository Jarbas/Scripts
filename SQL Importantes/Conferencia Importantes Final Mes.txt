------------| SELECT VERIFICA A QUANTIDADE DE CONSUMOS MP X  PRODUTOS MOVIMENTO | ------------------------

SELECT CMP.COD_EMPRESA, CMP.COD_CONSUMO,
  (SELECT COUNT(* ) FROM CONSUMO_MATERIA_PRIMA CMPP WHERE CMPP.COD_EMPRESA = CMP.COD_EMPRESA AND CMPP.COD_CONSUMO = CMP.COD_CONSUMO  ) AS QTDE_CONSUMO,
  (SELECT COUNT(* ) FROM PRODUTOS_MOVIMENTO PM WHERE (PM.COD_EMPRESA = CMP.COD_EMPRESA) AND PM.COD_DOCUMENTO = CMP.COD_CONSUMO AND PM.TIPO_MOVIMENTO = 'S' AND PM.SITUACAO = 'A'  AND PM.ORIGEM_MOVIMENTO ='M' ) AS QTDA_PM,
  (SELECT SUM(PE.PESO ) FROM PRODUTOS_ETIQUETAS PE WHERE PE.COD_ETIQUETA = CMP.COD_ETIQUETA AND ((PE.STATUS = 'A') OR PE.STATUS = 'B') ) AS SOMA_PE, 
  (SELECT SUM(PM.QUANTIDADE ) FROM PRODUTOS_MOVIMENTO PM WHERE (PM.COD_EMPRESA = CMP.COD_EMPRESA) AND PM.COD_DOCUMENTO = CMP.COD_CONSUMO AND PM.TIPO_MOVIMENTO = 'S' AND PM.SITUACAO = 'A'  AND PM.ORIGEM_MOVIMENTO ='M' ) AS SOMA_PM
  FROM CONSUMO_MATERIA_PRIMA CMP
  LEFT JOIN PRODUTOS_MOVIMENTO PM ON (CMP.COD_EMPRESA = PM.COD_EMPRESA) AND (CMP.COD_MOVIMENTO = PM.COD_MOVIMENTO)
  WHERE (CMP.COD_EMPRESA = :COD_EMPRESA)  AND (TRUNC (PM.DATA_MOVIMENTO) BETWEEN TO_DATE(:DATA_1) AND TO_DATE(:DATA_2)) 
  ORDER BY CMP.COD_EMPRESA, PM.DATA_MOVIMENTO, CMP.COD_CONSUMO;


 SELECT CMP.COD_EMPRESA, COUNT(*)
  FROM CONSUMO_MATERIA_PRIMA CMP
  WHERE (CMP.COD_EMPRESA = :COD_EMPRESA)  AND (TRUNC (CMP.DATA) BETWEEN TO_DATE(:DATA_1) AND TO_DATE(:DATA_2))  
  GROUP BY CMP.COD_EMPRESA;
  
  SELECT COUNT(* ) FROM PRODUTOS_MOVIMENTO PM 
  WHERE (PM.COD_EMPRESA = :COD_EMPRESA) AND  PM.TIPO_MOVIMENTO = 'S' AND PM.SITUACAO <> 'I'AND  PM.ORIGEM_MOVIMENTO ='M' 
  AND (TRUNC (PM.DATA_MOVIMENTO) BETWEEN TO_DATE(:DATA_1) AND TO_DATE(:DATA_2)) ;
  


------------| SELECT VERIFICA A QUANTIDADE DE ITENS NAS SOLICITACOES E QUANTIDADE DE ITENS NO MOVIMENTO | ------------------------


SELECT SM.COD_EMPRESA, SM.STATUS, SM.COD_SOLICITACAO, SM.DATA_SOLICITACAO,
(SELECT SUM(SMI.QUANTIDADE_ENTREGUE )  FROM SOLICITACOES_MATERIAL_ITENS SMI WHERE SMI.COD_EMPRESA =  SM.COD_EMPRESA AND SMI.COD_SOLICITACAO = SM.COD_SOLICITACAO ) AS QUANTIDADE_SM,
(SELECT SUM(PM.QUANTIDADE ) FROM PRODUTOS_MOVIMENTO PM WHERE (PM.COD_EMPRESA = SM.COD_EMPRESA) AND PM.COD_DOCUMENTO = SM.COD_SOLICITACAO AND PM.TIPO_MOVIMENTO = 'S' AND PM.SITUACAO = 'A'  AND PM.ORIGEM_MOVIMENTO ='S' ) AS QTDA_PM, 
(SELECT COUNT( SMI.COD_PRODUTO)  FROM SOLICITACOES_MATERIAL_ITENS SMI WHERE SMI.COD_EMPRESA =  SM.COD_EMPRESA AND SMI.COD_SOLICITACAO = SM.COD_SOLICITACAO ) AS CONTADOR,
(SELECT COUNT(PM.COD_MOVIMENTO) FROM PRODUTOS_MOVIMENTO PM WHERE (PM.COD_EMPRESA = SM.COD_EMPRESA) AND PM.COD_DOCUMENTO = SM.COD_SOLICITACAO AND PM.TIPO_MOVIMENTO = 'S' AND PM.SITUACAO = 'A' AND PM.ORIGEM_MOVIMENTO ='S' ) AS PM
  FROM SOLICITACOES_MATERIAL SM
WHERE   SM.STATUS =  'C' AND (TRUNC(SM.DATA_SOLICITACAO)) BETWEEN TO_DATE(:DATA_INICIAL) AND TO_DATE(:DATA_FINAL) 
--VERIFICAR COM TODOS OS STATUS ('R','L','E','A' )
ORDER BY SM.DATA_SOLICITACAO;

-------------| VEREFICA PRODUTOS QUE FORAM MOVIMENTADOS SEM SOLICITACAO |------------------------------
     

SELECT *  FROM PRODUTOS_MOVIMENTO PM 
WHERE (PM.COD_EMPRESA = :COD_EMPRESA) AND TRUNC(PM.DATA_MOVIMENTO)  BETWEEN TO_DATE(:DATA_INICIAL) AND TO_DATE(:DATA_FINAL)  AND  PM.TIPO_MOVIMENTO = 'S' AND PM.SITUACAO = 'A' AND (PM.ORIGEM_MOVIMENTO ='S'   or PM.ORIGEM_MOVIMENTO ='V') 
AND NOT EXISTS( SELECT * FROM SOLICITACOES_MATERIAL_ITENS SMI WHERE SMI.COD_MOVIMENTO = PM.COD_MOVIMENTO ) AND NOT EXISTS( SELECT * FROM LCTO_FISCAL_SAI_ITENS LFSI WHERE LFSI.COD_EMPRESA = PM.COD_EMPRESA AND  LFSI.COD_MOVIMENTO = PM.COD_MOVIMENTO )  ; ;

SELECT *  FROM PRODUTOS_MOVIMENTO PM 
WHERE (PM.COD_EMPRESA = :COD_EMPRESA) AND TRUNC(PM.DATA_MOVIMENTO)  BETWEEN TO_DATE(:DATA_INICIAL) AND TO_DATE(:DATA_FINAL)  AND  PM.TIPO_MOVIMENTO = 'S' AND PM.SITUACAO = 'A' AND PM.ORIGEM_MOVIMENTO ='V'    
AND NOT EXISTS( SELECT * FROM LCTO_FISCAL_SAI_ITENS LFSI WHERE LFSI.COD_EMPRESA = PM.COD_EMPRESA AND  LFSI.COD_MOVIMENTO = PM.COD_MOVIMENTO )  ;

SELECT *  FROM PRODUTOS_MOVIMENTO PM 
WHERE (PM.COD_EMPRESA = :COD_EMPRESA) AND TRUNC(PM.DATA_MOVIMENTO)  BETWEEN TO_DATE(:DATA_INICIAL) AND TO_DATE(:DATA_FINAL)  AND  PM.TIPO_MOVIMENTO = 'S' AND PM.SITUACAO = 'A' AND PM.ORIGEM_MOVIMENTO ='V'    
AND NOT EXISTS( SELECT * FROM LCTO_FISCAL_SAI_ITENS LFSI WHERE LFSI.COD_EMPRESA = PM.COD_EMPRESA AND  LFSI.COD_MOVIMENTO = PM.COD_MOVIMENTO )  ;


-------------| QUANDO O PRODUTO NÃO É IGUAL NA SM E PM |------------------------------

SELECT PM.COD_EMPRESA, PM.COD_DOCUMENTO, PM.COD_PRODUTO , SMI.COD_PRODUTO  
FROM PRODUTOS_MOVIMENTO PM
LEFT JOIN SOLICITACOES_MATERIAL_ITENS SMI ON PM.COD_EMPRESA = SMI.COD_EMPRESA AND PM.COD_DOCUMENTO = SMI.COD_SOLICITACAO AND  PM.COD_MOVIMENTO = SMI.COD_MOVIMENTO
LEFT JOIN SOLICITACOES_MATERIAL SM ON SMI.COD_EMPRESA = SM.COD_EMPRESA AND SMI.COD_SOLICITACAO = SM.COD_SOLICITACAO
WHERE   SM.STATUS =  'C' AND (TRUNC(SM.DATA_SOLICITACAO)) BETWEEN TO_DATE(:DATA_INICIAL) AND TO_DATE(:DATA_FINAL)
AND SMI.COD_PRODUTO <> PM.COD_PRODUTO ; 


SELECT PM.COD_DOCUMENTO AS DOCUMENTO, PM.COD_PRODUTO AS PRODUTO, PM.QUANTIDADE AS  QTDA, 'PM' FROM PRODUTOS_MOVIMENTO PM
WHERE PM.COD_DOCUMENTO = 38678 AND PM.SITUACAO = 'A' 
UNION ALL
SELECT SMI.COD_SOLICITACAO AS DOCUMENTO, SMI.COD_PRODUTO AS PRODUTO, SMI.QUANTIDADE_ENTREGUE, 'SM'     AS QTDA FROM SOLICITACOES_MATERIAL_ITENS SMI
WHERE SMI.COD_SOLICITACAO = 38678;


------------| SELECT VERIFICA QUANTAS SOLICITACOES ESTAO COM ITENS ZERADOS E POSSUIEM MOVIMENTO NO ESTOQUE | ------------------------

SELECT SM.COD_EMPRESA, SM.STATUS, SM.COD_SOLICITACAO, SM.DATA_SOLICITACAO, (SELECT COUNT( SMI.COD_PRODUTO)  FROM SOLICITACOES_MATERIAL_ITENS SMI WHERE SMI.COD_EMPRESA =  SM.COD_EMPRESA AND SMI.COD_SOLICITACAO = SM.COD_SOLICITACAO ) AS CONTADOR,
( SELECT COUNT(PM.COD_MOVIMENTO) FROM PRODUTOS_MOVIMENTO PM WHERE (PM.COD_EMPRESA = SM.COD_EMPRESA) AND PM.COD_DOCUMENTO = SM.COD_SOLICITACAO AND PM.TIPO_MOVIMENTO = 'S'  AND PM.ORIGEM_MOVIMENTO = 'S' )  AS PM
 FROM SOLICITACOES_MATERIAL SM
WHERE  (TRUNC(SM.DATA_SOLICITACAO)) BETWEEN TO_DATE(:DATA_INICIAL) AND TO_DATE(:DATA_FINAL)  AND (SELECT COUNT( SMI.COD_PRODUTO)  FROM SOLICITACOES_MATERIAL_ITENS SMI WHERE SMI.COD_EMPRESA =  SM.COD_EMPRESA AND SMI.COD_SOLICITACAO = SM.COD_SOLICITACAO ) = 0
AND ( SELECT COUNT(PM.COD_MOVIMENTO) FROM PRODUTOS_MOVIMENTO PM WHERE (PM.COD_EMPRESA = SM.COD_EMPRESA) AND PM.COD_DOCUMENTO = SM.COD_SOLICITACAO  ) >0
GROUP BY SM.COD_EMPRESA,SM.STATUS, SM.COD_SOLICITACAO,SM.DATA_SOLICITACAO
ORDER BY SM.COD_EMPRESA, SM.COD_SOLICITACAO,SM.DATA_SOLICITACAO;


------------| COMPARACAO QUANTIDADE SM X QUANTIDADE PM  | --------------------



SELECT PM.COD_EMPRESA, PM.COD_DOCUMENTO, PM.COD_PRODUTO,  PM.QUANTIDADE, SMI.QUANTIDADE_ENTREGUE, PM.* 
FROM PRODUTOS_MOVIMENTO PM
LEFT JOIN SOLICITACOES_MATERIAL_ITENS SMI ON PM.COD_EMPRESA = SMI.COD_EMPRESA AND PM.COD_DOCUMENTO = SMI.COD_SOLICITACAO AND PM.COD_PRODUTO = SMI.COD_PRODUTO AND PM.COD_MOVIMENTO = SMI.COD_MOVIMENTO
WHERE TRUNC(PM.DATA_HORA_LANCAMENTO) BETWEEN TO_DATE(:DATA_INICIAL) AND TO_DATE(:DATA_FINAL) AND SMI.QUANTIDADE_ENTREGUE <> PM.QUANTIDADE;  


-----------| COMPARACAO DATAS DE MOVIMENTAÇÃO  NFE X PM  | --------------------


SELECT LFE.COD_EMPRESA, LFE.COD_ENTRADA,  LFEI.COD_PRODUTO, PR.DESCRICAO , PM.COD_PRODUTO,  LFEI.QUANTIDADE, PM.QUANTIDADE,  LFE.DATA_ENTRADA, PM.DATA_MOVIMENTO 
FROM LCTO_FISCAL_ENT_ITENS LFEI
INNER JOIN LCTO_FISCAL_ENT LFE ON LFEI.COD_EMPRESA = LFE.COD_EMPRESA AND LFEI.COD_ENTRADA = LFE.COD_ENTRADA
LEFT JOIN TIPO_MOVIMENTO_FISCAL TMF ON  LFE.COD_EMPRESA = TMF.COD_EMPRESA AND LFE.COD_TIPO_MOVIMENTO = TMF.COD_TIPO_MOVIMENTO
LEFT JOIN PRODUTOS_MOVIMENTO PM ON LFEI.COD_EMPRESA = PM.COD_EMPRESA AND LFEI.COD_MOVIMENTO = PM.COD_MOVIMENTO
LEFT JOIN PRODUTOS PR ON LFEI.COD_PRODUTO = PR.COD_PRODUTO
WHERE TRUNC(LFE.DATA_ENTRADA) BETWEEN TO_DATE(:DATA_INICIAL) AND TO_DATE(:DATA_FINAL) AND TMF.ID_CONTROLA_ESTOQUE = 'S' AND LFEI.ID_CONTROLA_ESTOQUE = 'S'   ;


-----------| COMPARACAO DE NOTA FISCAL DE SAIDA X COD_COCUMENTO NO PM | --------------------

SELECT LFS.COD_EMPRESA, LFS.COD_SAIDA,
(SELECT COUNT(LFSI.COD_PRODUTO ) FROM LCTO_FISCAL_SAI_ITENS LFSI WHERE LFSI.COD_EMPRESA = LFS.COD_EMPRESA AND LFSI.COD_SAIDA = LFS.COD_SAIDA  ) AS CONTA_ITENS_NOTA, 
(SELECT COUNT(PM.COD_MOVIMENTO) FROM PRODUTOS_MOVIMENTO PM WHERE (PM.COD_EMPRESA = LFS.COD_EMPRESA) AND PM.COD_DOCUMENTO = LFS.COD_SAIDA AND PM.TIPO_MOVIMENTO = 'S' AND PM.SITUACAO = 'A' AND PM.ORIGEM_MOVIMENTO = 'V' ) AS CONTA_ITENS_PM,
(SELECT SUM(LFSI.QUANTIDADE ) FROM LCTO_FISCAL_SAI_ITENS LFSI WHERE LFSI.COD_EMPRESA = LFS.COD_EMPRESA AND LFSI.COD_SAIDA = LFS.COD_SAIDA   ) AS SOMA_QTDA_NOTA,
(SELECT SUM(PM.QUANTIDADE ) FROM PRODUTOS_MOVIMENTO PM WHERE (PM.COD_EMPRESA = LFS.COD_EMPRESA) AND PM.COD_DOCUMENTO =LFS.COD_SAIDA AND PM.TIPO_MOVIMENTO = 'S' AND PM.SITUACAO = 'A' AND  PM.ORIGEM_MOVIMENTO = 'V' ) AS SOMA_QTDA_PM
FROM LCTO_FISCAL_SAI LFS
LEFT JOIN TIPO_MOVIMENTO_FISCAL TMF  ON  LFS.COD_EMPRESA = TMF.COD_EMPRESA AND LFS.COD_TIPO_MOVIMENTO = TMF.COD_TIPO_MOVIMENTO
WHERE TRUNC(LFS.DATA_EMISSAO ) BETWEEN TO_DATE(:DATA_INICIAL) AND TO_DATE(:DATA_FINAL) AND LFS.SITUACAO = 'M'  AND TMF.ID_CONTROLA_ESTOQUE = 'S'  ;


  SELECT LFS.COD_TIPO_MOVIMENTO,TM.ID_CONTROLA_ESTOQUE, PR.DESCRICAO,  LFSI.VALOR_UNITARIO * LFSI.QUANTIDADE AS TOTAL, LFSI.*  FROM LCTO_FISCAL_SAI_ITENS LFSI
 LEFT JOIN LCTO_FISCAL_SAI LFS ON LFSI.COD_EMPRESA = LFS.COD_EMPRESA AND LFSI.COD_SAIDA = LFS.COD_SAIDA
 LEFT JOIN TIPO_MOVIMENTO_FISCAL TM ON LFS.COD_EMPRESA = TM.COD_EMPRESA AND LFS.COD_TIPO_MOVIMENTO = TM.COD_TIPO_MOVIMENTO
 LEFT JOIN PRODUTOS PR ON LFSI.COD_PRODUTO = PR.COD_PRODUTO
 WHERE (LFSI.COD_EMPRESA = :COD_EMPRESA) AND    LFS.SITUACAO = 'M' AND TM.ID_CONTROLA_ESTOQUE = 'S' AND LFSI.COD_MOVIMENTO IS  NULL
 AND TRUNC(LFS.DATA_EMISSAO ) BETWEEN TO_DATE(:DATA_INICIAL) AND TO_DATE(:DATA_FINAL);

 
-----------| COMPARACAO DE NOTA FISCAL DE ENTRADA X COD_COCUMENTO NO PM | --------------------

SELECT LFE.COD_EMPRESA, LFE.COD_ENTRADA,
(SELECT COUNT(LFEI.COD_PRODUTO ) FROM LCTO_FISCAL_ENT_ITENS LFEI WHERE LFEI.COD_EMPRESA = LFE.COD_EMPRESA AND LFEI.COD_ENTRADA = LFE.COD_ENTRADA   AND (NOT EXISTS(SELECT * FROM PRODUTOS_SERVICOS PS WHERE PS.COD_PRODUTO = LFEI.COD_PRODUTO)  ) ) AS CONTA_ITENS_NOTA, 
(SELECT COUNT(PM.COD_MOVIMENTO) FROM PRODUTOS_MOVIMENTO PM WHERE (PM.COD_EMPRESA = LFE.COD_EMPRESA) AND PM.COD_DOCUMENTO = LFE.COD_ENTRADA AND PM.TIPO_MOVIMENTO = 'E' AND PM.SITUACAO = 'A' AND PM.ORIGEM_MOVIMENTO = 'N' ) AS CONTA_ITENS_PM,
(SELECT SUM(LFEI.QUANTIDADE ) FROM LCTO_FISCAL_ENT_ITENS LFEI WHERE LFEI.COD_EMPRESA = LFE.COD_EMPRESA AND LFEI.COD_ENTRADA = LFE.COD_ENTRADA  AND (NOT EXISTS(SELECT * FROM PRODUTOS_SERVICOS PS WHERE PS.COD_PRODUTO = LFEI.COD_PRODUTO)  )   ) AS SOMA_QTDA_NOTA,
(SELECT SUM(PM.QUANTIDADE ) FROM PRODUTOS_MOVIMENTO PM WHERE (PM.COD_EMPRESA = LFE.COD_EMPRESA) AND PM.COD_DOCUMENTO =LFE.COD_ENTRADA AND PM.TIPO_MOVIMENTO = 'E' AND PM.SITUACAO = 'A' AND  PM.ORIGEM_MOVIMENTO = 'N' ) AS SOMA_QTDA_PM
FROM LCTO_FISCAL_ENT LFE
LEFT JOIN TIPO_MOVIMENTO_FISCAL TMF  ON  LFE.COD_EMPRESA = TMF.COD_EMPRESA AND LFE.COD_TIPO_MOVIMENTO = TMF.COD_TIPO_MOVIMENTO
WHERE TRUNC(LFE.DATA_ENTRADA) BETWEEN TO_DATE(:DATA_INICIAL) AND TO_DATE(:DATA_FINAL)  AND TMF.ID_CONTROLA_ESTOQUE = 'S'  AND LFE.TIPO_MODELO NOT IN (21,22,57,6,99);

SELECT LFEI.COD_ENTRADA, PM.COD_DOCUMENTO , LFEI.QUANTIDADE, PM.QUANTIDADE,  LFEI.* FROM LCTO_FISCAL_ENT_ITENS LFEI
JOIN LCTO_FISCAL_ENT LFE ON LFEI.COD_ENTRADA = LFE.COD_ENTRADA AND LFEI.COD_EMPRESA = LFE.COD_EMPRESA
JOIN PRODUTOS_MOVIMENTO PM ON  LFEI.COD_MOVIMENTO = PM.COD_MOVIMENTO AND LFEI.COD_EMPRESA = PM.COD_EMPRESA
WHERE TRUNC(LFE.DATA_ENTRADA) BETWEEN TO_DATE(:DATA_INICIAL) AND TO_DATE(:DATA_FINAL) AND PM.COD_DOCUMENTO <> LFEI.COD_ENTRADA;


SELECT LFEI.COD_ENTRADA, PM.COD_DOCUMENTO , LFEI.QUANTIDADE, PM.QUANTIDADE,  LFEI.* FROM LCTO_FISCAL_ENT_ITENS LFEI
JOIN LCTO_FISCAL_ENT LFE ON LFEI.COD_ENTRADA = LFE.COD_ENTRADA AND LFEI.COD_EMPRESA = LFE.COD_EMPRESA
JOIN PRODUTOS_MOVIMENTO PM ON  LFEI.COD_MOVIMENTO = PM.COD_MOVIMENTO AND LFEI.COD_EMPRESA = PM.COD_EMPRESA
WHERE TRUNC(LFE.DATA_ENTRADA) BETWEEN TO_DATE(:DATA_INICIAL) AND TO_DATE(:DATA_FINAL) AND PM.COD_DOCUMENTO <> LFEI.COD_ENTRADA;



----------| VERIFICA DIFA NOTAS  |---------------------------

SELECT PM.VALOR_DIF_ALIQUOTA, LFEI.VALOR_DIFA,  LFEI.* FROM LCTO_FISCAL_ENT_ITENS LFEI
LEFT JOIN LCTO_FISCAL_ENT LFE ON LFEI.COD_EMPRESA = LFE.COD_EMPRESA AND LFEI.COD_ENTRADA  = LFE.COD_ENTRADA
LEFT JOIN CFOP CFO ON    LFEI.COD_EMPRESA = CFO.COD_EMPRESA AND LFEI.COD_CFOP = CFO.COD_CFOP
LEFT JOIN PRODUTOS_MOVIMENTO PM ON LFEI.COD_EMPRESA = PM.COD_EMPRESA AND LFEI.COD_MOVIMENTO = PM.COD_MOVIMENTO
WHERE TRUNC(LFE.DATA_ENTRADA) BETWEEN TO_DATE(:DATA_INICIAL) AND TO_DATE(:DATA_FINAL) AND CFO.DIF_ALIQUOTA = 'S' ;                                                                                                                                                  

----------| VERIFICA MOVIMENTACAO PRODUTOS_MOVIMENTO DIFERENTE DA NOTA  |---------------------------


SELECT  LFE.DATA_ENTRADA, PM.DATA_MOVIMENTO,  LFEI.* FROM LCTO_FISCAL_ENT_ITENS LFEI
LEFT JOIN LCTO_FISCAl_ENT LFE ON LFEI.COD_EMPRESA = LFE.COD_EMPRESA AND LFEI.COD_ENTRADA  = LFE.COD_ENTRADA
LEFT JOIN PRODUTOS_MOVIMENTO PM ON LFEI.COD_EMPRESA = PM.COD_EMPRESA AND LFEI.COD_MOVIMENTO = PM.COD_MOVIMENTO
LEFT JOIN TIPO_MOVIMENTO_FISCAL TMF ON LFE.COD_TIPO_MOVIMENTO = TMF.COD_TIPO_MOVIMENTO
WHERE TRUNC(LFE.DATA_ENTRADA) BETWEEN TO_DATE(:DATA_INICIAL) AND TO_DATE(:DATA_FINAL) AND TMF.ID_CONTROLA_ESTOQUE = 'S';   
 
----------| VERIFICA SE FRETE FOI RATEADO |---------------------------                                        


SELECT  LFEI.COD_EMPRESA, LFEI.COD_ENTRADA , LFE.DATA_ENTRADA, LFEI.COD_PRODUTO , PM.VALOR_DIF_ALIQUOTA, PM.VALOR_DIF_ALIQUOTA_FRETE, PM.VALOR_RATEIO_FRETE, 
PM.VALOR_UNITARIO, LFEI.COD_MOVIMENTO, CF.VALOR_FRETE, CF.COD_CONHECIMENTO
 FROM CONHECIMENTO_FRETE CF 
INNER JOIN CONHECIMENTO_FRETE_NOTAS_ENT CFN ON CF.COD_EMPRESA = CFN.COD_EMPRESA AND CF.COD_CONHECIMENTO = CFN.COD_CONHECIMENTO
LEFT JOIN LCTO_FISCAL_ENT LFE ON LFE.COD_EMPRESA = CFN.COD_EMPRESA AND  LFE.COD_ENTRADA = CFN.COD_ENTRADA
LEFT JOIN LCTO_FISCAL_ENT_ITENS LFEI ON LFE.COD_EMPRESA = LFEI.COD_EMPRESA AND LFE.COD_ENTRADA = LFEI.COD_ENTRADA 
LEFT JOIN CFOP CFO ON LFEI.COD_CFOP = CFO.COD_CFOP 
INNER JOIN  PRODUTOS_MOVIMENTO PM ON LFEI.COD_EMPRESA = PM.COD_EMPRESA AND LFEI.COD_PRODUTO = PM.COD_PRODUTO AND LFEI.COD_ENTRADA = PM.COD_DOCUMENTO AND LFEI.COD_MOVIMENTO = PM.COD_MOVIMENTO

WHERE TRUNC(CF.DATA_ENTRADA ) BETWEEN TO_DATE(:DATA_INICIAL) AND TO_DATE(:DATA_FINAL);


----------| VERIFICA DIFA FRETE |---------------------------  


SELECT  LFEI.COD_EMPRESA, LFEI.COD_ENTRADA , LFE.DATA_ENTRADA, LFEI.COD_PRODUTO , PM.VALOR_DIF_ALIQUOTA, PM.VALOR_DIF_ALIQUOTA_FRETE, PM.VALOR_RATEIO_FRETE, 
PM.VALOR_UNITARIO, LFEI.COD_MOVIMENTO, CF.VALOR_FRETE, CF.COD_CONHECIMENTO
 FROM CONHECIMENTO_FRETE CF 
INNER JOIN CONHECIMENTO_FRETE_NOTAS_ENT CFN ON CF.COD_EMPRESA = CFN.COD_EMPRESA AND CF.COD_CONHECIMENTO = CFN.COD_CONHECIMENTO
LEFT JOIN LCTO_FISCAL_ENT LFE ON LFE.COD_EMPRESA = CFN.COD_EMPRESA AND  LFE.COD_ENTRADA = CFN.COD_ENTRADA
LEFT JOIN LCTO_FISCAL_ENT_ITENS LFEI ON LFE.COD_EMPRESA = LFEI.COD_EMPRESA AND LFE.COD_ENTRADA = LFEI.COD_ENTRADA 
LEFT JOIN CFOP CFO ON CF.COD_CFOP = CFO.COD_CFOP AND CFO.COD_EMPRESA = CF.COD_EMPRESA  AND CFO.DIF_ALIQUOTA = 'S'
INNER JOIN  PRODUTOS_MOVIMENTO PM ON LFEI.COD_EMPRESA = PM.COD_EMPRESA AND LFEI.COD_PRODUTO = PM.COD_PRODUTO AND LFEI.COD_ENTRADA = PM.COD_DOCUMENTO AND LFEI.COD_MOVIMENTO = PM.COD_MOVIMENTO

WHERE TRUNC(CF.DATA_ENTRADA ) BETWEEN TO_DATE(:DATA_INICIAL) AND TO_DATE(:DATA_FINAL) AND CFO.DIF_ALIQUOTA = 'S' ;


----------| VERIFICA ESTOQUE NEGATIVO |---------------------------  

SELECT  PP.COD_PRODUTO, PR.DESCRICAO,  RETORNA_SALDO_ESTOQUE_ITEM(1, PP.COD_PRODUTO )  FROM PRODUTOS_PRIMARIOS PP
LEFT JOIN PRODUTOS PR ON PP.COD_PRODUTO = PR.COD_PRODUTO
WHERE RETORNA_SALDO_ESTOQUE_ITEM(1, PP.COD_PRODUTO ) < 0;


------------| VERIFICA ETIQUETAS ATIVAS QUE PASSARAM NO PLANO DE EMBARQUE |------------

SELECT PE.COD_ETIQUETA, PE.STATUS,  PEL.* FROM PLANO_EMBARQUE_LEITURA PEL
LEFT JOIN PRODUTOS_ETIQUETAS PE ON PEL.COD_ETIQUETA = PE.COD_ETIQUETA
WHERE PE.STATUS = 'A';


----------| VEREFICA SE PEDIDOS ESTÃO NA CARTEIRA |-------------------
SELECT * FROM PEDIDOS_ITENS_ENTREGA PIE   
LEFT JOIN PEDIDOS PE ON PIE.COD_PEDIDO = PE.COD_PEDIDO 
WHERE PIE.COD_PRODUTO <> 65635  AND   NOT PIE.SITUACAO IN ('I', 'C')   AND    
NOT EXISTS ( SELECT * FROM CARTEIRA_PEDIDOS CP  WHERE CP.COD_PEDIDO = PIE.COD_PEDIDO AND CP.COD_REVISAO = PIE.COD_REVISAO AND CP.SEQUENCIAL = PIE.SEQUENCIAL AND  CP.PROGRAMACAO = PIE.PROGRAMACAO ) 
 AND TRUNC(PIE.DATA_ENTREGA) BETWEEN TO_DATE(:DATA_1) AND TO_DATE(:DATA_2) AND PE.TIPO <> 'F' ;   
 
 ---------|VERIFICA CONHECIMENTO DE FRETE VINCULADO EM NFE E NFS|---------------
 
 
 SELECT * FROM CONHECIMENTO_FRETE CF
WHERE  EXISTS ( SELECT * FROM CONHECIMENTO_FRETE_NOTAS_SAI CN WHERE CN.COD_CONHECIMENTO = CF.COD_CONHECIMENTO 
AND CN.COD_EMPRESA = CF.COD_EMPRESA  ) 
AND EXISTS ( SELECT * FROM CONHECIMENTO_FRETE_NOTAS_ENT CNE WHERE CNE.COD_CONHECIMENTO = CF.COD_CONHECIMENTO AND CNE.COD_EMPRESA = CF.COD_EMPRESA  );

